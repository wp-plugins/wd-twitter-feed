/**
 * Package: amarkal
 * Version: 0.1.0
 * Date: 2015-02-02
 */
function Amarkal(){}jQuery(document).ready(function(a){Amarkal.Notifier={},Amarkal.Notifier.top=32,Amarkal.Notifier.notifications=[],Amarkal.Notifier.notify=function(b,c){var d=document.createElement("div"),e=document.createElement("p"),f=document.createElement("div");d.setAttribute("class","ao-notification notifier-"+c),f.setAttribute("class","ao-notification-button fa fa-times"),d.appendChild(e),d.appendChild(f),e.innerHTML=b,a(f).click(function(){Amarkal.Notifier.removeNotification(d)}),a(d).css({top:Amarkal.Notifier.top+"px"}),a(".amarkal-options").append(d),Amarkal.Notifier.top+=a(d).outerHeight()+10,Amarkal.Notifier.notifications.push(d)},Amarkal.Notifier.success=function(a){Amarkal.Notifier.notify(a,"success")},Amarkal.Notifier.error=function(a){Amarkal.Notifier.notify(a,"error")},Amarkal.Notifier.removeNotification=function(b){var c=Amarkal.Notifier.notifications.indexOf(b),d=a(b).outerHeight()+10;for(Amarkal.Notifier.top-=d,b.parentNode.removeChild(b),Amarkal.Notifier.notifications.splice(c,1);c<Amarkal.Notifier.notifications.length;c++)a(Amarkal.Notifier.notifications[c]).animate({top:"-="+d})},Amarkal.Options={},Amarkal.Options.formID="ao-form",Amarkal.Options.init=function(){Amarkal.Options.Sections.init(),a(".form-control-button").click(function(b){b.preventDefault(),b.stopPropagation(),Amarkal.Options[a(this).attr("data-action")]()});for(var b=Amarkal.Options.State.get("notifications"),c=0;c<b.length&&b;c++)Amarkal.Notifier.notify(b[c].message,b[c].type);for(var d=Amarkal.Options.State.get("errors"),c=0;c<d.length&&d;c++){var e=Amarkal.Options.Sections.getByID(d[c].section);e.addNotification(d[c].message)}a(".amarkal-options .append-control-menu").click(function(b){b.preventDefault(),b.stopPropagation(),a(this).parent().hasClass("active")?a(".form-control-button").removeClass("active"):(a(".form-control-button").removeClass("active"),a(this).parent().toggleClass("active"))}),a('[data-type="help"]').tooltip({delay:{show:0,hide:250}})},Amarkal.Options.save=function(){Amarkal.Options.State.set("action","save"),Amarkal.Options.submit()},Amarkal.Options.reset=function(){Amarkal.Options.State.set("action","reset-all"),Amarkal.Options.submit()},Amarkal.Options.resetSection=function(){Amarkal.Options.State.set("action","reset-section"),Amarkal.Options.submit()},Amarkal.Options.export=function(){Amarkal.Notifier.success("This feature is not yet implemented.")},Amarkal.Options.exportAs=function(){Amarkal.Notifier.success("This feature is not yet implemented.")},Amarkal.Options.import=function(){Amarkal.Notifier.success("This feature is not yet implemented.")},Amarkal.Options.submit=function(){a("#"+Amarkal.Options.formID).submit()},Amarkal.Options.Section=function(b){this.id=b,this.button=a('[data-section="'+this.id+'"]'),this.triangleEl=a('<i class="fa fa-exclamation-triangle"></i>'),this.circleEl=a('<span class="number"></span>'),this.noticePanel=a("#"+b).find(".section-notifications"),this.notices=[],this.updated=[],this.subsections=[],this.init()},Amarkal.Options.Section.prototype.init=function(){this.button.append(this.triangleEl,this.circleEl),this.circleEl.hide(),this.triangleEl.hide();var b=this;a("#"+this.id).find(".field-wrapper").change(function(){a(this).addClass("field-updated"),b.updated.push(a(this).attr("for")),a.unique(b.updated),b.circleEl.text(b.updated.length),b.circleEl.show()}),a("#"+this.id+" .sub-menu a").each(function(){a(this).click(function(c){c.preventDefault(),b.hideAllSubsections(),b.showSubsection(a(this).attr("href"))}),b.subsections.push(a(this).attr("href"))}),this.hideAllSubsections(),this.showSubsection(this.subsections[0])},Amarkal.Options.Section.prototype.show=function(){Amarkal.Options.State.set("active_section",this.id),this.button.addClass("active"),a("#"+this.id).show()},Amarkal.Options.Section.prototype.hide=function(){this.button.removeClass("active"),a("#"+this.id).hide()},Amarkal.Options.Section.prototype.showSubsection=function(b){a('[href="'+b+'"]').addClass("active"),a('[data-subsection="'+b+'"]').show()},Amarkal.Options.Section.prototype.hideAllSubsections=function(){a("#"+this.id+" .sub-menu a").each(function(){a(this).removeClass("active"),a('[data-subsection="'+a(this).attr("href")+'"]').hide()})},Amarkal.Options.Section.prototype.addNotification=function(a){this.notices.push(a),this.triangleEl.show();for(var b="",c=0;c<this.notices.length;c++)b+="<p>"+this.notices[c]+"</p>";this.noticePanel.html(b)},Amarkal.Options.Section.prototype.clearNotifications=function(){this.triangleEl.hide(),this.notices=[]},Amarkal.Options.Sections={},Amarkal.Options.Sections.sectionList=[],Amarkal.Options.Sections.init=function(){a(".amarkal-options .section").each(function(){var b=new Amarkal.Options.Section(a(this).attr("id"));Amarkal.Options.Sections.sectionList.push(b),b.hide(),b.id===Amarkal.Options.State.get("active_section")&&b.show()}),a("[data-section]").click(function(b){b.preventDefault(),Amarkal.Options.Sections.hideAll(),Amarkal.Options.Sections.getByID(a(this).attr("data-section")).show(),a("#"+Amarkal.Options.formID).attr("action",a(this).attr("href"))})},Amarkal.Options.Sections.getByID=function(a){for(var b=0;b<Amarkal.Options.Sections.sectionList.length;b++){var c=Amarkal.Options.Sections.sectionList[b];if(c.id===a)return c}},Amarkal.Options.Sections.hideAll=function(){for(var a=0;a<Amarkal.Options.Sections.sectionList.length;a++)Amarkal.Options.Sections.sectionList[a].hide()},Amarkal.Options.State={},Amarkal.Options.State.inputID="options-state",Amarkal.Options.State.data=a.parseJSON(a("#"+Amarkal.Options.State.inputID).val()),Amarkal.Options.State.set=function(a,b){Amarkal.Options.State.data[a]=b,Amarkal.Options.State.update()},Amarkal.Options.State.get=function(a){var b=Amarkal.Options.State.data;return null!==b&&b.hasOwnProperty(a)?b[a]:!1},Amarkal.Options.State.update=function(){a("#options-state").val(JSON.stringify(Amarkal.Options.State.data))},Amarkal.UI={},Amarkal.UI.components=[],Amarkal.UI.init=function(){for(var b=0;b<Amarkal.UI.components.length;b++){var c=Amarkal.UI.components[b];a(c.wrapper).each(function(){c.init(this),a(c.getInput(this)).change(function(){var b=a(this).parents(".afw-ui-component");b.trigger("change"),b.attr("data-value",a(this).val())})})}},Amarkal.UI.register=function(a){Amarkal.UI.components.push(a)},Amarkal.UI.setValue=function(b,c){for(var d=0;d<Amarkal.UI.components.length;d++)a(b).hasClass(Amarkal.UI.components[d].wrapper.replace(".",""))&&Amarkal.UI.components[d].setValue(b,c)},Amarkal.UI.register({wrapper:".afw-ui-component-checkbox",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).value=c,values=c.split(","),a(b).children("label").each(function(){var b=a(this).children("input");b.prop("checked",a.inArray(b.val(),values)>-1)})},init:function(b){a(b).children("label").click(function(){var c=[],d=a(this).parent(),e=d.children("input");a(b).hasClass("afw-ui-component-disabled")||(d.find(":checked").each(function(){c.push(a(this).val())}),e.val(c),e.trigger("change"))})}}),Amarkal.UI.register({wrapper:".afw-ui-composite-component",getInput:function(b){return a(b).children("input")},setValue:function(){throw"Composite components cannot dynamically change value"},init:function(b){a(b).find(".afw-ui-component").change(function(){var b=a(this).parent().parent().children("input"),c=a(this).parent().parent().find(".afw-ui-component"),d=b.attr("data-template");b.val(d);for(var e=0;e<c.length;e++){var f=b.val(),g=a(c[e]);b.val(f.replace("<% "+g.attr("data-name")+" %>",g.attr("data-value")))}})}}),Amarkal.UI.register({wrapper:".afw-ui-component-content",getInput:function(){return!1},setValue:function(){},init:function(b){a(b).hasClass("afw-ui-component-ajaxified")&&a(b).find(".afw-ui-iframe").load(function(){a(this).height(a(this).contents().find("html").outerHeight())})}}),Amarkal.UI.register({wrapper:".afw-ui-component-dropdown",getInput:function(b){return a(b).children("select")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).select2("val",c)},init:function(b){this.getInput(b).select2({width:"resolve"}).change(function(){a(this).parents(".afw-ui-component").trigger("change")})}}),Amarkal.UI.register({wrapper:".afw-ui-component-progressbar",getInput:function(){return!1},setValue:function(b,c){var d=a(b).find(".progressbar"),e=parseFloat(d.attr("data-max")),f=c/e*100;a(b).find(".progressbar-inner").css({width:f+"%"}),a(b).find(".progressbar-label").text(c+"/"+e)},init:function(b){var c=a(b).find(".progressbar"),d=parseFloat(c.attr("data-value")),e=parseFloat(c.attr("data-max")),f=d/e*100,g=a("<div></div>"),h=a("<div></div>"),i=a("<div></div>");g.addClass("progressbar-outer"),h.addClass("progressbar-inner").css({width:f+"%"}),i.addClass("progressbar-label").text(d+"/"+e),g.append(h),c.append(g,i)}}),Amarkal.UI.register({wrapper:".afw-ui-component-slider",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),"range"===a(b).attr("data-type")?a(b).find(".slider").slider("values",c):a(b).find(".slider").slider("value",c)},init:function(b){var c=parseFloat(a(b).attr("data-max")),d=parseFloat(a(b).attr("data-min")),e=parseFloat(a(b).attr("data-step")),f=a(b).attr("data-type"),g=a(b).hasClass("afw-ui-component-disabled");if("range"===f){var h=a(b).find("input");a(b).find(".slider").slider({min:d,max:c,step:e,range:!0,disabled:g,values:[parseInt(h[0].value),parseInt(h[1].value)],slide:function(a,b){h[0].value=b.values[0],h[1].value=b.values[1],h.trigger("change")}})}else{var i=a(b).find("input");a(b).find(".slider").slider({min:d,max:c,step:e,range:f,disabled:g,value:parseInt(i.val()),slide:function(a,b){i.val(b.value),i.trigger("change")}})}a(b).find(".ui-slider-handle").html('<i class="fa fa-navicon fa-rotate-90"></i>')}}),Amarkal.UI.register({wrapper:".afw-ui-component-spinner",getInput:function(b){return a(b).find("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).spinner("value",c)},init:function(b){var c=this.getInput(b),d=c.attr("data-max"),e=c.attr("data-min"),f=c.attr("data-step"),g=c.attr("disabled");c.spinner({min:e,max:d,step:f,disabled:g}),a(b).find(".ui-spinner-down").detach().insertBefore(c),a(b).find(".ui-spinner-up").html('<i class="fa fa-chevron-right"></i>'),a(b).find(".ui-spinner-down").html('<i class="fa fa-chevron-left"></i>'),a(b).find(".ui-spinner-button").click(function(){c.trigger("change")})}}),Amarkal.UI.register({wrapper:".afw-ui-component-text",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c)},init:function(b){this.getInput(b).keyup(function(){a(this).parent().attr("data-value",a(this).val())})}}),Amarkal.UI.register({wrapper:".afw-ui-component-textarea",getInput:function(b){return a(b).find("textarea")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c)},init:function(b){this.getInput(b).resizable({minHeight:150,minWidth:250}),a(b).find(".ui-resizable-s").html('<i class="fa fa-bars"></i>'),a(b).find(".ui-resizable-e").html('<i class="fa fa-bars fa-rotate-90"></i>')}}),Amarkal.UI.register({wrapper:".afw-ui-component-togglebutton",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c),values=c.split(","),a(b).children("label").each(function(){a.inArray(a(this).attr("data-value"),values)>-1?a(this).addClass("active"):a(this).removeClass("active")})},init:function(b){a(b).children("label").click(function(){var b=[],c=a(this).parent(),d=c.children("input");d.attr("disabled")||("false"===c.attr("data-multivalue")&&c.find("label").removeClass("active"),a(this).toggleClass("active"),c.find(".active").each(function(){b.push(a(this).attr("data-value"))}),d.val(b),d.trigger("change"))})}}),Amarkal.Editor={},Amarkal.Editor.Plugins={},Amarkal.Editor.Plugins.register=function(a,b){Amarkal.Editor.Plugins[a](b)},Amarkal.Editor.addButton=function(a,b){Amarkal.Editor.Plugins.register(a,b)},Amarkal.Editor.parseTemplate=function(a,b){return a.replace(/(<%([^\%\<\>]*)%>)/g,function(a,c,d){return b[d.trim()]})},Amarkal.Editor.PopupForm=function(){},Amarkal.Editor.PopupForm.init=function(){var b=a(".afw-editor-popup-form");0!==b.length&&this.setValues()},Amarkal.Editor.PopupForm.setValues=function(){var b=top.tinymce.activeEditor.selection.getContent();""!==b&&a(".afw-editor-popup-form").find(".afw-ui-component").each(function(){var c=a(this).attr("data-name"),d=new RegExp(c+'="([^"]+)"'),e=b.match(d);null!==e&&Amarkal.UI.setValue(this,e[1])})},Amarkal.Editor.Plugins.IconBoxPopup=function(b){"undefined"!=typeof tinymce&&tinymce.PluginManager.add(b.slug,function(c){var d=Amarkal.Editor.Plugins.IconBoxPopup.calcDimensions(b.buttons.length,b.max_cols);c.addButton(b.slug,{text:b.text,icon:b.icon,title:b.title,onclick:function(){c.windowManager.open({title:b.title,width:d.width,height:d.height,body:[{type:"container",html:Amarkal.Editor.Plugins.IconBoxPopup.genHTML(b.buttons,b.max_cols)}],buttons:[]}),a(".afw-editor-popup-icon").click(function(){var d=a(this).attr("data-id"),e=b.buttons[d].action,f=b.buttons[d].title,g=b.buttons[d].width,h=b.buttons[d].height,i=a(this).hasClass("disabled"),j=ajaxurl+"?action="+e;i||(c.windowManager.close(),c.windowManager.open({title:f,url:j,width:g,height:h,buttons:[{text:"Insert",classes:"widget btn primary first abs-layout-item",disabled:!1,onclick:function(){var b=tinymce.activeEditor.windowManager.getParams(),d=a('iframe[src$="'+e+'"]').contents(),f={};d.find(".afw-ui-component").each(function(){var b=a(this).attr("data-name"),c="undefined"==a(this).attr("data-value")?"":a(this).attr("data-value");f[b]=c}),c.insertContent(Amarkal.Editor.parseTemplate(b.template,f)),c.windowManager.close()}},{text:"Close",onclick:function(){c.windowManager.close()}}]},{template:b.buttons[d].template,selection:tinymce.activeEditor.selection.getContent()}))})}})})},Amarkal.Editor.Plugins.IconBoxPopup.genHTML=function(a,b){for(var c="",d=0;d<a.length;d++)c+='<div class="afw-editor-popup-icon'+(a[d].disabled?" disabled":"")+'" title="'+a[d].label+'" data-id="'+d+'">',c+='<img src="'+a[d].img+'"/>',c+="<h3>"+a[d].label+"</h3>",c+="</div>",(d+1)%b===0&&(c+="<br />");return c},Amarkal.Editor.Plugins.IconBoxPopup.calcDimensions=function(a,b){var c=107,d=Math.min(b,a),e=Math.ceil(a/b);return{width:d*c+25,height:e*c+25}},Amarkal.Widget={},Amarkal.Widget.init=function(){a("body").hasClass("widgets-php")&&(a(document).trigger("widget_init"),Amarkal.Widget.setAjaxListener(),a(document).bind("widget_init",function(){a('[data-type="help"]').tooltip({delay:{show:0,hide:250}}),Amarkal.UI.init()}))},Amarkal.Widget.setAjaxListener=function(){a(document).ajaxComplete(function(b,c,d){var e,f,g,h={},i=d.data.split("&");for(e in i)f=i[e].split("="),h[decodeURIComponent(f[0])]=decodeURIComponent(f[1]);h.action&&"save-widget"===h.action&&(g=a('input.widget-id[value="'+h["widget-id"]+'"]').parents(".widget"),c.responseText?a(document).trigger("widget_init",g):wpWidgets.save(g,0,1,0))})},Amarkal.Widget.init(),Amarkal.UI.init(),Amarkal.Options.init(),Amarkal.Editor.PopupForm.init()});